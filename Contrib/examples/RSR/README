Making ICC input profiles to match RSR target + monitor profiles

Sunday 25 March 2007
Joseph Goldstone (joseph@lp.com), Lilliputian Pictures LLC

The process of making ICC input profiles, usable by (e.g.) Photoshop CS2 as
something that can be assigned to a DPX image to provide a reasonable match to
the results of the Rising Run Research's cineShake plug-in, is as follows:

0) choose the machine on which your profile will be used.  To make up
   a concrete example, let's say an artist named Bill is going to be
   using this profile in Photoshop CS2 on a PC running Windows XP.

1) choose a Mac that
     1a) has been profiled with cineProfiler, and
     1b) has been profiled with an ICC-compliant profiler, e.g. Eye-One Match
     1c) has Shake installed, with a valid license for it
     1d) has RSR's cineShake plug-in installed, and a valid license for it
   
   Make sure that the directory in which the SampleICC binaries have
   been installed is in your search path (i.e. your shell's PATH variable).

   To continue our example we'll say that an administrator named Steve
   is running these tools; so you'll be running 01_make_probe_image.sh
   on Steve's Mac.

   So on Steve's Mac, run the 01_make_probe_image.sh shell script to
   make a 'probe' image, basically a flattened color cube.  That
   script can be found in the same directory as this README document.
   
     % ./01_make_probe_image.sh

   (The '%' representing your shell prompt.)

   The resulting probe image is in 32-bit-per-component TIFF format in
   the directory /var/tmp:

     -rw-rw-r--   1 steve  wheel  485830 Mar 26 11:17 /var/tmp/32bpcProbe.tiff

2) continuing on Steve's Mac, use a third-party tool such as After
   Effects to convert the 32-bit-per-component TIFF image to a
   10-bit-per-component Cineon image.  A tiny After Effects 7 project,
   ConversionProject.aep, is included in this software distribution in
   the same directory as this README file.

   If After Effects is not available, look around for something that is;
   perhaps CS2 can do this itself, or you might use a public-domain utility
   such as those found in ImageMagik or (if it's still around) pbmplus.

3) back on Bill's PC, find the cineSpace monitor profile that is
   appropriate for that machine.  By default, these are placed in
   \Program Files\RisingSunResearch\cinespace\monitor-profiles\.
   Put this monitor profile onto a USB flash drive.

4) Take that USB flash drive over to Steve's Mac, and copy it into the
   place where RSR monitor profiles are stored (by default, this will
   be in /Applications/cineSpace/monitor-profiles).

5) Open the Shake application, and create a FileIn node to read in the
   32-bit-per-component TIFF image [i.e. /var/tmp/32bpcProbe.tiff].
   Create a cineShake node which takes as input the output of the
   FileIn node.  Set the monitor profile of the cineShake node to be
   that which you just copied from Bill's PC.  Set the target profile
   to be the one obtained from Rising Sun which describes the
   relationship between the Cineon values you send to your film
   recorder or service bureau, and the CIE XYZ values of the projected
   film image in your screening room.  Set the cineEngine parameters
   to be the 3DAccurate cineEngineType, the Scaling scalingType, the
   None gamutTreatment and the none PretransformType.  Set the
   Advanced parameters to be bradfordTransform Off and
   BlackPointCorrection off.

6) Set up a helper application from the /Application/Utilities
   directory to help you line up the red line of Grab's selection box
   with the red line around Shake's image.  Open the DigitalColor
   Meter application from that same directory.  Under DigitalColor
   Meter -> Preferences, set the magnification factor to 8x, and the
   Aperture color to Gray.  Close the DigitalColor Meter Preferences
   window.  Now on the DigitalColor Meter window itself, move the
   Aperture size slider all the way to the left, such that the
   aperture is a single pixel wide.

6) Open Grab.app (located in the /Applications/Utilities/ directory on
   Steve's Mac) to capture the color-corrected display of the probe
   image in Shake.  In particular, use Grab's "Capture Selection"
   option [shortcut: cmd-shift-A] to capture the color-corrected
   image, and line up the red line of the Grab selection EXACTLY with
   the single-pixel-wide red line surrounding the displayed image in
   Shake.  With DigitalColor Meter active, this means moving the
   cursor until DigitalColor Meter shows you that you are exactly on
   top of the upper-left corner of Shake's red rectangle, then
   carefully pressing down and dragging out a rectangle that ends up
   exactly on top of the red pixel that is the lower-right corner of
   Shake's red rectangle.

   Save the resulting grab to cineSpace's directory of monitor
   profiles (/Applications/cineSpace/monitor-profiles by default),
   naming it something like Bill_monitor_profile_probe.tiff.

7) Open the resulting image in Preview.  Use Tools->Get Info to verify,
   under the Summary panel, the image size: it should be exactly
   568x288.  If it is not, you'll need to keep using Grab until you
   can get an image exactly that size whose outer edge pixels are red.

   Write down the name of the ColorSync profile from that same Summary
   panel, as you will need it in the next step.

   (Alternatively you can use tiffutil's -info option to examine the
   size and embedded profile of the TIFF output of Grab.)

8) Next, you will be running the 02_make_input_profile_from_probe.sh
   script, found in the same directory as this README.
   
   If this is the first time you have run this script, there is a
   parameter in this script that you must set.  It is the monitor
   profile in effect on the screen with which you used Grab.app, and
   the name of this profile was shown in Preview's Tools->Get Info
   panel in the prior step.  You will be inserting it into the script
   as the value of the MONITOR_PROFILE_PATH variable, probably around
   line 21 of the script.  You will need the full path to the profile,
   and Preview only shows you the final element in the path, so this
   may mean Steve needs to contacting his system administrator to find
   out where s/he is keeping monitor profiles on Steve's Mac.

   Once this is set, assuming that Shake is always running on the same
   monitor, there's no need to change this for other profile-creation
   runs (i.e. for other artists' PCs).

   Run the script, supplying it with three or four command-line arguments.
   The first argument is the path to the captured and Shaken probe
   image, which if you've been following along with this example will
   be in /Applications/cineSpace/monitor-profiles.  The second
   argument is a description of the profile.  If you want to embed
   spaces in this description, then put the description in quotes.
   And the last is the name of the profile that you'll be carrying
   back to Bill's machine.

   If you are using a pre-transform curve on your images (e.g. you are
   storing your images as 8-bit-per-component companded TIFF files,
   where the transformed files are created from 10-bit Cineon scans,
   stored during artists' manipulations as 8-bit TIFF, and taken back
   to 10-bit Cineon on the way out to the film recorder) you can
   specify a file containing that curve as a fourth argument to the
   02_make_input_profile_from_probe.sh script.  To make the file, for
   an 8-bit-per-component TIFF, use 
   
        create_pretransform_curve 8 pretransform.txt
   
   which will make a file named pretransform.txt in the current
   directory.  Note that this file may not be appropriate for your
   site; the parameters for this particular pretransform are a
   particular, and lossy, method of compressing 10 bits into 8 from
   Rising Sun Research.

   Here is an example pair of commands that include a pre-transform
   suitable for files of limited bit-depth.  The definition of MPDIR
   is only to keep the lines from wrapping in this README file.  You
   could either type this on one long line, or use the shell's
   continuation character, the backslash, to spread it across multiple
   lines as I do here:

        % export MPDIR=/Applications/cineSpace/monitor-profiles
	% ./02_make_input_profile_from_probe.sh \
		$MPDIR/Bill_monitor_profile_probe.tiff \
		"ICC RSR-style input profile for Bill" \
		$MPDIR/Bill_input_profile.icc \
		$MPDIR/pretransform.txt

8) Copy the resulting ICC input profile onto the USB flash drive, take
   the flash drive to Bill's machine, and put the ICC input profile
   into the directory
	C:\Program Files\Common Files\Adobe\Color\Profiles

9) Read the image on which Bill will be working into Photoshop CS2.
   Use the Edit->Assign Profile (Image->Mode->Assign Profile in the
   older Photoshop CS) command to assign the input profile you just
   made to the image.  Note that the name that appears in the pop-up
   menu is not the name of the profile on disk; it's the description
   of the profile that you entered above, in this case "ICC RSR-style
   input profile for Bill".

----

Acknowledgements:
   The 32-bit-TIFF-to-Cineon conversion example After Effects project
   is reproduced here with the kind permission of its author, Richard
   Patterson.

----

To do someday:
  automatically detect the red outline
  automatically extract the capturing profile's path

